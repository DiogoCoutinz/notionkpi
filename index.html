<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard KPIs</title>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #0f0f0f;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      padding: 40px 20px;
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 1.5rem;
      color: #e3e3e3;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
      gap: 20px;
      width: 100%;
      max-width: 1100px;
    }

    .card {
      background: #181818;
      border: 1px solid #2b2b2b;
      border-radius: 14px;
      padding: 20px;
      text-align: center;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
      transition: transform 0.2s ease, background 0.2s ease;
    }

    .card:hover {
      transform: translateY(-4px);
      background: #1d1d1d;
    }

    .label {
      font-size: 0.9rem;
      color: #aaa;
      margin-bottom: 8px;
    }

    .value {
      font-size: 1.8rem;
      font-weight: bold;
      color: #fff;
    }

    .trend {
      font-size: 0.9rem;
      margin-top: 6px;
    }

    .up {
      color: #4ade80;
    }

    .down {
      color: #f87171;
    }

    .neutral {
      color: #a3a3a3;
    }

    .footer {
      margin-top: 2rem;
      font-size: 0.85rem;
      color: #777;
    }
  </style>
</head>
<body>
  <h1>ðŸ“Š Dashboard Comercial</h1>
  <div id="kpiGrid" class="grid"></div>

  <div class="footer">
    Atualiza automaticamente a cada 60 segundos
  </div>

  <script>
    const API_URL = "https://uvvxvqrymdywxoqgnnvd.supabase.co/rest/v1/view_dashboard_geral?select=*&apikey=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV2dnh2cXJ5bWR5d3hvcWdubnZkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkwODM3NDAsImV4cCI6MjA3NDY1OTc0MH0.3vNlo61Yl4c3XG7-8yDCKVBO4-f0iNMJeHXSSgzAI5w";

    async function fetchData() {
      const res = await fetch(API_URL);
      const data = await res.json();
      return data[0];
    }

    function renderKPIs(d) {
      const container = document.getElementById("kpiGrid");
      container.innerHTML = "";

      const cards = [
        { label: "ðŸ“… ReuniÃµes Hoje", value: d.reunioes_hoje },
        { label: "ðŸ‘¥ Contactos Hoje", value: d.contactos_hoje },
        { label: "ðŸ“ˆ VariaÃ§Ã£o ReuniÃµes vs Ontem", value: d.reunioes_vs_ontem_pct, format: "%" },
        { label: "ðŸ“‰ VariaÃ§Ã£o Contactos vs Ontem", value: d.contactos_vs_ontem_pct, format: "%" },
        { label: "ðŸ§‘â€ðŸ’¼ Top Consultor do Dia", value: d.top_consultor_dia },
        { label: "ðŸ† Top Consultor do MÃªs", value: d.top_consultor_mes },
        { label: "ðŸ“Š Taxa ConversÃ£o Total", value: d.taxa_conversao_total, format: "%" },
        { label: "â±ï¸ MÃ©dia Dias atÃ© ReuniÃ£o", value: d.media_dias_contacto_para_reuniao },
        { label: "ðŸ—“ï¸ Taxa No-Show", value: d.taxa_no_show, format: "%" },
      ];

      cards.forEach(c => {
        const card = document.createElement("div");
        card.className = "card";

        const label = document.createElement("div");
        label.className = "label";
        label.textContent = c.label;

        const value = document.createElement("div");
        value.className = "value";
        value.textContent = c.value + (c.format || "");

        const trend = document.createElement("div");
        trend.className = "trend " + (c.value > 0 ? "up" : c.value < 0 ? "down" : "neutral");
        if (typeof c.value === "number" && c.format === "%")
          trend.textContent = c.value > 0 ? "â–² Subida" : c.value < 0 ? "â–¼ Queda" : "â€” EstÃ¡vel";
        else
          trend.textContent = "";

        card.appendChild(label);
        card.appendChild(value);
        card.appendChild(trend);
        container.appendChild(card);
      });
    }

    async function load() {
      const data = await fetchData();
      renderKPIs(data);
    }

    load();
    setInterval(load, 60000); // atualiza a cada 60 segundos
  </script>
</body>
</html>
